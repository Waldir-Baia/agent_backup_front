<section class="playbook-page">
  <header class="playbook-header">
    <div>
      <h1>PlayBook</h1>
      <p class="subtitle">
        Salve seus comandos mais usados e reutilize tudo com apenas um clique.
      </p>
    </div>

    <div class="header-actions">
      <div class="search-field">
        <i class="pi pi-search"></i>
        <input
          pInputText
          type="search"
          placeholder="Filtrar por título ou comando"
          [value]="filterTerm()"
          (input)="filterTerm.set($any($event.target).value)"
        />
        <button
          pButton
          *ngIf="filterTerm()"
          type="button"
          icon="pi pi-times"
          class="p-button-text"
          (click)="filterTerm.set('')"
        ></button>
      </div>
    </div>
  </header>

  <div class="playbook-layout">
    <div class="table-card">
      <header class="table-header">
        <h2 class="table-title">Comandos cadastrados</h2>
        <button pButton type="button" label="Novo comando" icon="pi pi-plus" (click)="openCreateDialog()"></button>
      </header>

        <div class="table-wrapper" *ngIf="!loading(); else loadingState">
          <p-table
            [value]="filteredCommands()"
            [paginator]="false"
            class="playbook-table"
            *ngIf="filteredCommands().length > 0; else emptyState"
          >
            <ng-template pTemplate="header">
              <tr>
                <th>Título</th>
                <th>Descrição</th>
                <th>Comando</th>
                <th class="actions-column">Ações</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-command>
              <tr>
                <td>
                  <div class="cell-title">
                    <strong>{{ command.titulo }}</strong>
                    <span class="cell-meta">{{ command.created_at | date: 'dd/MM/yyyy HH:mm' }}</span>
                  </div>
                </td>
                <td>{{ command.descricao || 'Sem descrição' }}</td>
                <td><pre class="command-preview">{{ command.comando }}</pre></td>
                <td class="actions-column">
                  <button pButton type="button" icon="pi pi-play" class="p-button-text" (click)="executeCommand(command)"></button>
                  <button pButton type="button" icon="pi pi-pencil" class="p-button-text" (click)="openEditDialog(command)"></button>
                  <button pButton type="button" icon="pi pi-trash" class="p-button-danger p-button-text" (click)="delete(command)"></button>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
    </div>
  </div>
</section>

<ng-template #loadingState>
  <div class="state-wrapper">
    <mat-progress-spinner diameter="40" mode="indeterminate"></mat-progress-spinner>
    <p>Carregando comandos...</p>
  </div>
</ng-template>

<ng-template #emptyState>
  <div class="state-wrapper">
    <p>Nenhum comando cadastrado ainda.</p>
    <button pButton type="button" label="Cadastrar primeiro" icon="pi pi-plus" (click)="openCreateDialog()"></button>
  </div>
</ng-template>
