<section class="playbook-page">
  <header class="playbook-header">
    <div>
      <h1>PlayBook</h1>
      <p class="subtitle">
        Salve seus comandos mais usados e reutilize tudo com apenas um clique.
      </p>
    </div>

    <div class="header-actions">
      <div class="search-field">
        <i class="pi pi-search"></i>
        <input
          pInputText
          type="search"
          placeholder="Filtrar por título ou comando"
          [value]="filterTerm()"
          (input)="filterTerm.set($any($event.target).value)"
        />
        <button
          pButton
          *ngIf="filterTerm()"
          type="button"
          icon="pi pi-times"
          class="p-button-text"
          (click)="filterTerm.set('')"
        ></button>
      </div>
    </div>
  </header>

  <div class="playbook-layout">
    <div class="table-card">
      <header class="table-header">
        <h2 class="table-title">Comandos cadastrados</h2>
        <button pButton type="button" label="Novo comando" icon="pi pi-plus" (click)="openCreateDialog()"></button>
      </header>

        <div class="table-wrapper" *ngIf="!loading(); else loadingState">
          <ng-container *ngIf="filteredCommands().length > 0; else emptyState">
            <div class="playbook-grid">
              <article
                class="playbook-card"
                *ngFor="let command of filteredCommands(); trackBy: trackById"
              >
                <header class="playbook-card__header">
                  <div>
                    <span class="playbook-card__label">Título</span>
                    <h3>{{ command.titulo }}</h3>
                    <p class="playbook-card__meta">
                      {{ command.created_at | date: 'dd/MM/yyyy HH:mm' }}
                    </p>
                  </div>
                </header>

                <div class="playbook-card__body">
                  <div class="playbook-card__section">
                    <span class="playbook-card__label">Descrição</span>
                    <p>{{ command.descricao || 'Sem descrição' }}</p>
                  </div>

                  <div class="playbook-card__section">
                    <span class="playbook-card__label">Comando</span>
                    <pre class="command-preview">{{ command.comando }}</pre>
                  </div>
                </div>

                <footer class="playbook-card__actions">
                  <button
                    pButton
                    type="button"
                    class="p-button-text"
                    icon="pi pi-play"
                    label="Executar"
                    (click)="executeCommand(command)"
                  ></button>
                  <button
                    pButton
                    type="button"
                    class="p-button-text"
                    icon="pi pi-pencil"
                    label="Editar"
                    (click)="openEditDialog(command)"
                  ></button>
                  <button
                    pButton
                    type="button"
                    class="p-button-danger p-button-text"
                    icon="pi pi-trash"
                    label="Excluir"
                    (click)="delete(command)"
                  ></button>
                </footer>
              </article>
            </div>
          </ng-container>
        </div>
    </div>
  </div>
</section>

<ng-template #loadingState>
  <div class="state-wrapper">
    <mat-progress-spinner diameter="40" mode="indeterminate"></mat-progress-spinner>
    <p>Carregando comandos...</p>
  </div>
</ng-template>

<ng-template #emptyState>
  <div class="state-wrapper">
    <p>Nenhum comando cadastrado ainda.</p>
    <button pButton type="button" label="Cadastrar primeiro" icon="pi pi-plus" (click)="openCreateDialog()"></button>
  </div>
</ng-template>
