<section class="logs-page">
  <div class="page-header">
    <div>
      <h2>Logs de backup</h2>
      <p>Acompanhe os arquivos enviados pelos agentes.</p>
    </div>
  </div>

  <section class="logs-filters">
    <div class="search-field">
      <i class="pi pi-search"></i>
      <input
        pInputText
        type="search"
        placeholder="Filtrar por cliente, arquivo ou erro"
        [value]="filterTerm()"
        (input)="filterTerm.set($any($event.target).value)"
      />
      <button
        pButton
        *ngIf="filterTerm()"
        type="button"
        icon="pi pi-times"
        class="p-button-text"
        (click)="filterTerm.set('')"
      ></button>
    </div>
  </section>

  <div class="logs-card">
    <div class="logs-card__content">
      <div *ngIf="loading(); else tableContent" class="loading-state">
        <mat-progress-spinner diameter="40" mode="indeterminate"></mat-progress-spinner>
        <span>Carregando logs...</span>
      </div>

      <ng-template #tableContent>
        <ng-container *ngIf="logs().length > 0; else emptyState">
          <section class="logs-grid">
            <article class="log-card" *ngFor="let log of logs()">
              <header class="log-card__header">
                <div>
                  <span class="log-card__label">Cliente</span>
                  <p class="log-card__client">{{ clientName(log.client_id) }}</p>
                </div>
                <div class="log-card__timestamp">
                  <span class="log-card__label">Registrado em</span>
                  <p>{{ log.created_at | date: 'dd/MM/yyyy HH:mm' }}</p>
                </div>
              </header>

              <div class="log-card__meta">
                <div class="meta-item">
                  <span class="log-card__label">Arquivo</span>
                  <p class="meta-value">{{ log.file_name }}</p>
                </div>
                <div class="meta-item">
                  <span class="log-card__label">Tamanho</span>
                  <p class="meta-value">{{ log.file_size_bytes | fileSize: 2 }}</p>
                </div>
                <div class="meta-item">
                  <span class="log-card__label">Data do arquivo</span>
                  <p class="meta-value">{{ log.file_creation_date | date: 'dd/MM/yyyy HH:mm' }}</p>
                </div>
              </div>

              <div
                class="error-card"
                [class.error-card--empty]="!log.error_message"
                [attr.title]="log.error_message || ''"
              >
                {{ truncatedErrorMessage(log.error_message) }}
              </div>
            </article>
          </section>
        </ng-container>

        <p-paginator
          [rows]="pageSize()"
          [first]="pageIndex() * pageSize()"
          [totalRecords]="total()"
          [rowsPerPageOptions]="pageSizeOptions"
          (onPageChange)="handlePage($event)"
        ></p-paginator>
      </ng-template>

      <ng-template #emptyState>
        <p class="empty-state">
          Nenhum log encontrado.
        </p>
      </ng-template>
    </div>
  </div>
</section>
